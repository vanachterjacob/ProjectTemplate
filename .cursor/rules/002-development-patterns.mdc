---
alwaysApply: false
description: ESC AL development patterns for BC26
globs:
  - "src/**/*.al"
---
# ESC Development Patterns

## Early Exit Pattern (ESC Mandatory)

```al
procedure ProcessCustomer(Customer: Record Customer; Amount: Decimal)
begin
    if Customer."Credit Limit (LCY)" <= 0 then
        exit;
    if Customer.Blocked <> Customer.Blocked::" " then
        exit;
    if Amount <= Customer."Credit Limit (LCY)" then
        exit;

    ProcessValidCustomer(Customer, Amount);
end;

// Always check empty key parameters first
procedure GetItemPictureBase64(ItemNo: Code[20]): Text
begin
    if ItemNo = '' then
        exit('');
    // ... rest of logic
end;
```

**Rule:** Exit early for invalid conditions, process at the end.

## Temporary Buffer Tables

```al
table 50000 "ABC My Buffer"
{
    Caption = 'My Buffer', Locked = true;      // Table caption locked (no UI)
    DataClassification = SystemMetadata;        // At TABLE level
    TableType = Temporary;

    fields
    {
        field(1; "Entry No."; Integer)
        {
            Caption = 'Entry No.';              // Field captions NOT locked (may appear in reports)
        }
    }

    keys
    {
        key(PK; "Entry No.")
        {
            Clustered = true;
        }
        // Secondary keys on temp tables: only add if actually used for filtering
    }
}
```

**Rules:**
- Table Caption: `Locked = true` (no UI)
- DataClassification: At table level, not field level
- Field Captions: NOT locked (may appear in reports)
- Secondary keys: Evaluate actual usage before adding

## Enum Patterns

```al
enum 50000 "ABC My Internal Option"
{
    Extensible = false;  // false when not supporting extensibility/publishers
    Caption = 'My Option';

    value(0; "None")
    {
        Caption = 'None';
    }
}
```

**Rules:**
- `Extensible = false` when enum is internal/not designed for extension
- Caption should describe the option, not include data type

## Page Field Properties

```al
// Document fields - editable
field("ABC Print Option"; Rec."ABC Print Option")
{
    ApplicationArea = All;
    Importance = Additional;    // Use Additional for rarely-used fields
    ToolTip = 'Specifies...';
}

// Posted document fields - non-editable
field("ABC Print Option"; Rec."ABC Print Option")
{
    ApplicationArea = All;
    Editable = false;           // MANDATORY for posted documents
    Importance = Additional;
    ToolTip = 'Specifies...';
}
```

**Rules:**
- Don't duplicate Caption on page fields (inherits from table)
- Use `Importance = Additional` for infrequently-used fields
- Posted document fields MUST have `Editable = false`

## Upgrade Codeunit Pattern

```al
codeunit 50000 "ABC Upgrade"
{
    Subtype = Upgrade;
    Access = Internal;

    trigger OnUpgradePerCompany()
    begin
        UpgradeMyFeature();
    end;

    local procedure UpgradeMyFeature()
    var
        UpgradeTag: Codeunit "Upgrade Tag";
    begin
        if UpgradeTag.HasUpgradeTag(GetMyFeatureUpgradeTag()) then
            exit;

        // Upgrade logic here

        UpgradeTag.SetUpgradeTag(GetMyFeatureUpgradeTag());
    end;

    local procedure GetMyFeatureUpgradeTag(): Code[250]
    begin
        exit('ABC-MyFeature-001-20251209');
    end;

    [EventSubscriber(ObjectType::Codeunit, Codeunit::"Upgrade Tag", OnGetPerCompanyUpgradeTags, '', false, false)]
    local procedure OnUpgradePerCompanyRegisterTags(var PerCompanyUpgradeTags: List of [Code[250]])
    begin
        PerCompanyUpgradeTags.Add(GetMyFeatureUpgradeTag());
    end;
}
```

## Clean Conditionals (CASE over IF)

```al
procedure GetPriorityText(Status: Enum "ABC Document Status"): Text
var
    OpenLbl: Label 'Open';
    ApprovedLbl: Label 'Approved';
begin
    case Status of
        Status::Open:
            exit(OpenLbl);
        Status::Approved:
            exit(ApprovedLbl);
        else
            exit('');
    end;
end;
```

## TryFunction Pattern

```al
[TryFunction]
procedure TryProcessCustomer(CustomerNo: Code[20]): Boolean
var
    Customer: Record Customer;
begin
    if CustomerNo = '' then
        exit(false);
    if not Customer.Get(CustomerNo) then
        exit(false);
    if Customer.Blocked <> Customer.Blocked::" " then
        exit(false);

    ProcessCustomerData(Customer);
    exit(true);
end;
```

## Confirm Dialogs (ESC Pattern)

```al
// Always use ConfirmManagement, never direct Confirm()
var
    ConfirmManagement: Codeunit "Confirm Management";
    DeleteQst: Label 'Delete %1?';
begin
    if not ConfirmManagement.GetResponse(StrSubstNo(DeleteQst, Description), false) then
        exit;

    // Process after confirmation
end;
```

## Transaction Management

```al
// NEVER use Commit() without documentation
Commit(); // Required: Starting background session for async processing
```

## English-Only Development

```al
// ❌ BAD: Dutch in code
procedure BerekenBedrag(): Decimal

// ✅ GOOD: English only
procedure CalculateAmount(): Decimal
var
    AmountLbl: Label 'Amount';
```

**Rules:**
- All code in English
- No translation comments
- Translations via XLIFF Sync tool only

## ESC Ruleset Overrides

### Disabled Rules (Flexibility)
- **AA0005**: BEGIN..END compound statements
- **AA0072**: Variable naming suffix
- **AA0205**: Variable initialization
- **LC0026**: ToolTip period
- **LC0036**: ToolTip "Specifies"
- **LC0066**: ToolTip duplication
- **LC0078**: Temp table triggers

### Promoted to Warning (Critical)
- **AW0006**: UsageCategory/ApplicationArea
- **AS0094**: Use PermissionSet objects
- **LC0028**: Event subscriber syntax
- **LC0088**: Prefer Enums over Options
