---
alwaysApply: false
description: ESC performance standards for BC26
globs:
  - "src/**/*.al"
---
# ESC Performance Standards

## Performance Thresholds (ESC Mandatory)

| Records | Technique            | ESC Standard                    |
|---------|----------------------|---------------------------------|
| < 50    | Direct FindSet       | Minimal overhead                |
| > 5000  | Background Job Queue | Mandatory for UI responsiveness |
| > 30s   | Background processing| Required for long operations    |

## Response Time Requirements

**Mandatory thresholds:**
- Page load: < 2 seconds
- API response: < 1 second
- Report generation: < 30 seconds
- Background jobs: < 5 minutes

## Background Processing (ESC Policy)

### TaskScheduler vs Job Queue Entry

| Criteria       | TaskScheduler | Job Queue Entry          |
|----------------|---------------|--------------------------|
| **Duration**   | < 2 minutes   | > 2 minutes              |
| **Use cases**  | UI async      | Reports, bulk processing |
| **Error logic**| Simple        | Advanced retry           |

## Performance Critical Rules

### SetLoadFields Usage
```al
// ✅ GOOD: Read-only with known fields
Customer.SetLoadFields(Name, "Balance (LCY)");
if Customer.FindSet() then
    repeat
        ProcessCustomer(Customer);
    until Customer.Next() = 0;

// ❌ BAD: SetLoadFields before Modify
Customer.SetLoadFields(Name);
Customer.Modify();  // Fields not loaded
```

### Avoid Nested Loops
```al
// ❌ BAD: Nested loops
SalesHeader.FindSet();
repeat
    SalesLine.SetRange("Document No.", SalesHeader."No.");
    SalesLine.FindSet();
    repeat
        ProcessLine(SalesLine);
    until SalesLine.Next() = 0;
until SalesHeader.Next() = 0;

// ✅ GOOD: Use Query object
```

### Bulk Operations
```al
// ✅ GOOD: Bulk update
Customer.ModifyAll(Blocked, Customer.Blocked::" ", true);

// ❌ BAD: Loop with Modify
repeat
    Customer.Blocked := Customer.Blocked::" ";
    Customer.Modify();
until Customer.Next() = 0;
```

### Aggregations
```al
// ✅ GOOD: Use CalcSums
Customer.CalcSums("Balance (LCY)");
TotalBalance := Customer."Balance (LCY)";

// ❌ BAD: Manual loop
repeat
    TotalBalance += Customer."Balance (LCY)";
until Customer.Next() = 0;
```

## Production Testing Requirements

- [ ] Test with production-scale data volumes
- [ ] Account for network latency (cloud)
- [ ] Test concurrent user scenarios
- [ ] Validate actual business processes
- [ ] Cyclomatic complexity ≤ 15
